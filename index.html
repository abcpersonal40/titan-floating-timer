<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titan Timer</title>
    <style>
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            user-select: none;
        }
        h2 { color: #00E676; margin-bottom: 30px; }
        
        button {
            border: none;
            padding: 16px 30px;
            font-size: 18px;
            border-radius: 50px;
            margin: 10px;
            width: 85%;
            max-width: 320px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        button:active { transform: scale(0.95); }

        .btn-start { background: #2962FF; color: white; }
        .btn-stop { background: #FF1744; color: white; }
        
        /* ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¨‡¶æ‡¶ü‡¶® (‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶•‡¶æ‡¶ï‡¶¨‡ßá) */
        .btn-fix { 
            background: #FF9100; 
            color: black; 
            display: none; 
            border: 2px solid #FFEA00;
        }

        button:disabled {
            background: #333;
            color: #777;
            cursor: not-allowed;
            box-shadow: none;
        }

        #status { margin-top: 20px; color: #888; font-size: 14px; }
    </style>
</head>
<body>

    <h2>‚è±Ô∏è Titan Floating Timer</h2>

    <!-- ‡ßß. ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶¨‡¶æ‡¶ü‡¶® (‡¶Ø‡¶¶‡¶ø ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá) -->
    <button id="fixBtn" class="btn-fix" onclick="openSettings()">
        ‚ö†Ô∏è Allow 'Display Over Apps'
    </button>

    <!-- ‡ß®. ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® -->
    <button id="startBtn" class="btn-start" onclick="startOverlay()" disabled>
        ‚è≥ System Loading...
    </button>
    
    <!-- ‡ß©. ‡¶∏‡ßç‡¶ü‡¶™ ‡¶¨‡¶æ‡¶ü‡¶® -->
    <button class="btn-stop" onclick="stopOverlay()">
        üî¥ Stop Timer
    </button>

    <div id="status">Initializing...</div>

    <script>
        let isReady = false;

        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∞‡ßá‡¶°‡¶ø ‡¶π‡¶ì‡ßü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ
        document.addEventListener('deviceready', () => {
            console.log("Device Ready");
            
            // ‡ßß. ‡¶™‡ßç‡¶≤‡¶æ‡¶ó‡¶ø‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
            if (window.overlay) {
                isReady = true;
                const btn = document.getElementById('startBtn');
                btn.disabled = false;
                btn.innerText = "üü¢ Start Floating Timer";
                document.getElementById('status').innerText = "System Ready.";
            } else {
                document.getElementById('status').innerText = "Error: Overlay plugin failed!";
            }
        }, false);

        // ‡ß®. ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶æ
        function startOverlay() {
            if (!isReady) return;

            // ‡¶ì‡¶≠‡¶æ‡¶∞‡¶≤‡ßá ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ
            window.overlay.open('overlay.html', function () {
                // ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏
                document.getElementById('status').innerText = "Overlay is Running";
                document.getElementById('fixBtn').style.display = 'none'; // ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®
            }, function (err) {
                // ‡¶´‡ßá‡¶á‡¶≤ (‡¶Æ‡¶æ‡¶®‡ßá ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶®‡¶æ‡¶á)
                document.getElementById('status').innerText = "Permission Missing!";
                document.getElementById('status').style.color = "orange";
                
                // ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
                document.getElementById('fixBtn').style.display = 'flex';
                alert("Permission Required! Click the Orange Button.");
            });
        }

        // ‡ß©. ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ
        function openSettings() {
            if (window.cordova && window.cordova.plugins.settings) {
                // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡ßç‡¶∞‡ßü‡ßá‡¶° ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏‡ßá ‡¶®‡¶ø‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
                window.cordova.plugins.settings.open("action_manage_overlay_permission", 
                    () => console.log("Settings Opened"),
                    () => alert("Please go to Settings > Apps > Titan Timer manually.")
                );
            } else {
                alert("Manual: Settings > Apps > Titan Timer > Display over other apps > Allow");
            }
        }

        function stopOverlay() {
            if (window.overlay) {
                window.overlay.close();
                document.getElementById('status').innerText = "Stopped.";
                document.getElementById('status').style.color = "#888";
            }
        }
    </script>
</body>
</html>
